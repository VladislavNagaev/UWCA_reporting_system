
# Наименование проекта
Описание проекта


1. Replace_YandexCloudFiles_to_LocalStorage
    - waiting_for_file
        - 
    - prepare_save_path
    - save_file_to_LocalStorage
    - remove_file_from_YandexCloud
    - send_kafka_user_message
    - trigger-Check_validity_file

2. Check_validity_file









---
<details><summary><h2 style="display: inline">Схема</h2></summary><blockquote>

    ├── lib                         <- Директория с пользовательскими функциями.
    │   
    ├── data                        <- Директория с рабочими данными.
    │   │
    │   ├── processed               <- Окончательный, канонический набор данных.
    │   │
    │   ├── external                <- Данные из сторонних источников.
    │   │
    │   ├── interim                 <- Промежуточные данные, подвергшиеся преобразованию.
    │   │   │
    │   │   ├── interim-0           <- Обработка данных на этапе interim-0
    │   │   ├── interim-1           <- Обработка данных на этапе interim-1
    │   │   ├── interim-2           <- Обработка данных на этапе interim-2
    │   │   ├── interim-3           <- Обработка данных на этапе interim-3
    │   │   ├── interim-4           <- Обработка данных на этапе interim-4
    │   │   └── interim-5           <- Обработка данных на этапе interim-5
    │   │
    │   ├── control                 <- Визуальный контроль обработки данных.
    │   │
    │   ├── raw                     <- Исходный неизменяемый дамп данных.
    │   │   │
    │   │   ├── flight_sheets       <- Полетные листы.
    │   │   ├── flight_params       <- Полетные параметры.
    │   │   ├── flight_data         <- Полетные данные.
    │   │   └── auxiliary_data      <- Вспомогательные данные.
    │   │
    │   ├── unverified              <- Непроверенные данные.
    │   │   │
    │   │   ├── csv                 <- Файлы формата CSV.
    │   │   ├── pdf                 <- Файлы формата PDF.
    │   │   └── yaml                <- Файлы формата YAML.
    │   │
    │   └── unrecognized            <- Нераспознанные и невалидные данные.
    │   
    ├── results                     <- Директория с результирующими данными.
    │
    ├── logs                        <- Директория пользоватеских логов.
    │
    └── .gitignore                  <- Список игнорируемых при синхронизации с Git файлов и директорий.

</blockquote></details>


<details><summary><h2 style="display: inline">Обработка данных</h2></summary><blockquote>

Обработка данных включается в себя следующие пункты:
- `raw`:
    - Исходный незменяемый дамп данных в формате `csv`.
- `interim-0`:
    - Удаление пустых строк в начале файла
    - Удаление недопустимых символов в наименованиях столбцов
    - Пересохранение данных в бинарном формате `parquet`
- `interim-1`:
    - Удаление пустых столбцов (Unnamed).
    - Перевод перегрузок (`nx_цт`, `nу_цт`, `nz_цт`, `nx_нос`, `nу_нос`, `nz_нос`, `nx_хв`, `nу_хв`, `nz_хв`) в безразмерные величины (деление на `9.81`).
    - Корректировка единиц измерения скоростей (перевод в м/с и в км/ч).
    - Удаление ошибок (скачков данных) радиовысотомера (`БУР_H_бар_1`, `БУР_H_бар_2`, `БУР_H_Радиовысотомер`, `БУР_H_спутник`).
    - Приращение перегрузок (`nу_цт`, `nу_нос`, `nу_хв`, `ДКВ-21_Перегрузка_по_Y`) к единице (вычитание единицы).
- `interim-2`:
    - Пересчет значений датчиков `Ϭ` по изестным значениям `Н` (НЕ выполняется для файлов "Кочка").
- `interim-3`:
    - Выделение диапазонов полета по установленному алгоритму выдления диапазонов.
- `interim-4`:
    - Удаление ошибок в значениях напряжений
- `interim-5`:
    - Расчет нагрузок по результатам тензометрии
- `processed`:
    - Сохранение динных в финальную директорию

</blockquote></details>


<details><summary><h2 style="display: inline">Алгорит выделения диапазонов полета</h2></summary><blockquote>

<details><summary><h3 style="display: inline">Параметры алгоритма</h3></summary><blockquote>

Параметры настройки алгоритма задаются при помощи `YAML`-файла (`processing_params_3.yaml`). 

Файл содержит: 

### 1. Обозначения параметров данных

Обозначение            | Описание                     
:----------------------|:--------------------------------------------------------------------------------------
`time`                 | Время (с)                    
`horizontal_speed`     | Горизонтальная скорость (м/с)
`vertical_speed`       | Вертикальная скорость (м/с)  
`absolute_height`      | Высота абсолютная (м)        
`overload_y`           | Перегрузка по оси Y          
`overload_x`           | Перегрузка по оси X          
`vspeed_amplitude`     | Модуль амплитуды значений вертикальной скорости (`vertical_speed`) относительно нуля 
`overload_y_amplitude` | Модуль амплитуды значений перегрузки по оси Y (`overload_y`) относительно нуля 

### 2.  Параметры диапазонов полета

Обозначение | Расшифровка                 | Описание                     
:-----------|:----------------------------|:--------------------------------------------------------------------------------------
`ff`        | forward_flight              | Диапазон горизонтального полета
`trff`      | takeoff_run_forward_flight  | Участок пересечения диапазона разбега при взлете с диапазоном горизонтального полета
`fflr`      | forward_flight_landing_run  | Участок пересечения диапазона горизонтального полета с диапазоном пробега после посадки
`tr`        | takeoff_run                 | Диапазон разбега при взлёте
`lr`        | landing_run                 | Диапазон пробега после посадки
`tttr`      | takeoff_taxiing_takeoff_run | Участок пересечения диапазона рулежки перед взлетом с диапазоном разбега при взлете
`lrlt`      | landing_run_landing_taxiing | Участок пересечения диапазона пробега после посадки с диапазоном рулежки после посадки
`tt`        | takeoff_taxiing             | Диапазон рулежки перед взлетом
`lt`        | landing_taxiing             | Диапазон рулежки после посадки

### 3.  Параметры диапазонов полета могут включать следующие параметры:

Обозначение        | Вложенное обозначение  | Описание                     
:------------------|:-----------------------|:--------------------------------------------------------------------------------------
`range_name`       | .                      | Наименование диапазона 
`hspeed`           | .                      | Диапазон вертикальных скоростей в м/с, допустимых на участке в формате (minv, maxv), где minv и maxv - соотвественно минимальное и максимальное допустимое значение параметра
`duration`         | .                      | Диапазон допустимых продолжительностей участка в секундах в формате (mind, maxd), где mind и maxd - соотвественно минимальное и максимальное допустимое значение параметра
`range_ref`        | .                      | Словарь параметров референсного (родительского) участка, содеражщий в себе следующие параметры:
.                  | `range_name`           | Наименование референсного (родительского) участка
.                  | `boundary_side`        | Сторона (левая/правая) референсного (родительского) участка, которая граничит с текущим участом. Задается в формате right / left
.                  | `relative_range_width` | Диапазон относительных значений протяженности участка относительно  граничной точки референсного (родительского) участка, по которым будет производиться предварительная оценка данного участка.Задается в формате (left_b, right_b), где left_b и right_b - соотвественно относительные значение отступа влево или вправо относительно точки референсного (родительского) участка. Соотвествующие абсолютные значения отступов вычисляются домножением на максимальное допустимое значение параметра продолжительностей участка (duration) - maxd.
`sorting_list`     | .                      | Список набора параметров, по которым производится вычисление точной границы пересечения двух участков. Каждый набор параметров задается в формате (sort_feature, sort_state, sort_weight), где 
.                  | `sort_feature`         | Наименование параметра данных, по которму необходимо выполнить оценку,
.                  | `sort_state`           | Состояние веса (минимум/максимум), соотвествующего максимальному значению оцениваемого параметра. Задается в формате min / max.
.                  | `sort_weight`          | Весовой коэффициент соответствующего параметра данных.
`sorting_sections` | .                      | Строго убывающая последовательность длительностей участков, на которых будет осуществляться поиск оценка параметров из sorting_list. 

</blockquote></details>


<details><summary><h3 style="display: inline">Логика алгоритма</h3></summary><blockquote>

### 1. Выделение рабочих данных из исходного массива, включающих следующие параметры:

Обозначение            | Описание                     
:----------------------|:--------------------------------------------------------------------------------------
`time`                 | Время (с)                    
`horizontal_speed`     | Горизонтальная скорость (м/с)
`vertical_speed`       | Вертикальная скорость (м/с)  
`absolute_height`      | Высота абсолютная (м)        
`overload_y`           | Перегрузка по оси Y          
`overload_x`           | Перегрузка по оси X          

### 2. Обогащение данных следующими параметрами:

Обозначение            | Описание                     
:----------------------|:--------------------------------------------------------------------------------------         
`vspeed_amplitude`     | Модуль амплитуды значений вертикальной скорости (`vertical_speed`) относительно нуля 
`overload_y_amplitude` | Модуль амплитуды значений перегрузки по оси Y (`overload_y`) относительно нуля 

### 3. Выделение потенциальных участков горизонтального полета по следующим критериям:
- горизонтальная скорость (`horizontal_speed`) непрерывно находится в диапазоне от `hspeed[0]` до `hspeed[-1]` соотвествующего диапазона
- длительность потенциального участка находится в диапазоне от `duration[0]` до `duration[-1]` соотвествующего диапазона

### 4. Выделение участков пересечения потенциальных участков разбега при взлёте с потенциальными участками горизонтального полета (trff) по следующему алгоритму:
- участок включает в себя ЛЕВУЮ границу участка горизонтального полета
- участок отступает ВЛЕВО от ЛЕВОЙ границы участка горизонтального полета не более, чем на величину значения `relative_range_width[0]`*`duration[-1]` соотвествующего диапазона
- участок отступает ВПРАВО от ЛЕВОЙ границы участка горизонтального полета не более, чем на величину значения `relative_range_width[-1]`*`duration[-1]` соотвествующего диапазона
- горизонтальная скорость (`horizontal_speed`) непрерывно находится в диапазоне от `hspeed[0]` до `hspeed[-1]` соотвествующего диапазона
- длительность участка находится в диапазоне от `duration[0]` до `duration[-1]` соотвествующего диапазона

### 5. Выделение участков пересечения потенциальных участков горизонтального полета с потенциальными участками пробега после посадки (fflr) по следующему алгоритму:
- участок включает в себя ПРАВУЮ границу участка горизонтального полета
- участок отступает ВЛЕВО от ПРАВОЙ границы участка горизонтального полета не более, чем на величину значения `relative_range_width[0]`*`duration[-1]` соотвествующего диапазона
- участок отступает ВПРАВО от ПРАВОЙ границы участка горизонтального полета не более, чем на величину значения `relative_range_width[-1]`*`duration[-1]` соотвествующего диапазона
- горизонтальная скорость (`horizontal_speed`) непрерывно находится в диапазоне от `hspeed[0]` до hspeed[-1] соотвествующего диапазона
- длительность участка находится в диапазоне от `duration[0]` до `duration[-1]` соотвествующего диапазона

### 6. Уточнение ЛЕВЫХ границ потенциальных участков горизонтального полета обработкой участков trff по следующему алгоритму:
- присвоение вектора весов, где максимальный вес соотвествует МИНИМАЛЬНОМУ значению высоты (`absolute_height`)
- присвоение вектора весов, где максимальный вес соотвествует МИНИМАЛЬНОМУ значению вертикальной скорости (`vertical_speed`)
- суммирование всех векторов весов и выбор значения времени, соотвествующего МАКСИМАЛЬНОМУ весу суммарного вектора весов
- корректировка ЛЕВОЙ границы участка горизонтального полета по найденному значению времени

### 7. Уточнение ПРАВЫХ границ потенциальных участков горизонтального полета обработкой участков fflr по следующему алгоритму:
- присвоение вектора весов, где максимальный вес соотвествует МИНИМАЛЬНОМУ значению высоты (`absolute_height`)
- присвоение вектора весов, где максимальный вес соотвествует МАКСИМАЛЬНОЙ близости значения вертикальной скорости (`vertical_speed`) к нулю, т.е. модуль амплитуды значений вертикальной скорости относительно нуля МИНИМАЛЕН.
- присвоение вектора весов, где максимальный вес соотвествует МАКСИМАЛЬНОМУ значению модуля амплитуды перегрузки по оси Y (`overload_y`) относительно нуля
- суммирование всех векторов весов и выбор значения времени, соотвествующего МАКСИМАЛЬНОМУ весу суммарного вектора весов
- корректировка ПРАВОЙ границы участка горизонтального полета по найденному значению времени

### 8. Выделение потенциальных участков разбега при взлёте по следующему алгоритму:
- участок включает в себя ЛЕВУЮ границу горизонтального полета
- участок отступает ВЛЕВО от ЛЕВОЙ границы участка горизонтального полета не более, чем на величину значения `relative_range_width[0]`*`duration[-1]` соотвествующего диапазона, т.е. на величину значения максимальной продолжительностей участка (`duration[-1]`) в данном случае
- участок отступает ВПРАВО от ЛЕВОЙ границы участка горизонтального полета не более, чем на величину значения `relative_range_width[1]*``duration[-1]` соотвествующего диапазона, т.е. на НОЛЬ в данном случае
- горизонтальная скорость (`horizontal_speed`) непрерывно находится в диапазоне от `hspeed[0]` до hspeed[-1] соотвествующего диапазона
- длительность участка находится в диапазоне от `duration[0]` до `duration[-1]` соотвествующего диапазона

### 9. Выделение потенциальных участков пробега после посадки по следующему алгоритму:
- участок включает в себя ПРАВУЮ границу участка горизонтального полета
- участок отступает ВЛЕВО от ПРАВОЙ границы участка горизонтального полета не более, чем на величину значения `relative_range_width[0]`*`duration[-1]` соотвествующего диапазона, т.е. на НОЛЬ в данном случае
- участок отступает ВПРАВО от ПРАВОЙ границы участка горизонтального полета не более, чем на величину значения `relative_range_width[1]*``duration[-1]` соотвествующего диапазона, т.е. на величину значения максимальной продолжительностей участка (`duration[-1]`) в данном случае
- горизонтальная скорость (`horizontal_speed`) непрерывно находится в диапазоне от `hspeed[0]` до hspeed[-1] соотвествующего диапазона
- длительность участка находится в диапазоне от `duration[0]` до `duration[-1]` соотвествующего диапазона

### 10. Выделение участков пересечения потенциальных участков рулежки перед взлетом с потенциальными участками разбега при взлёте (tttr) по следующему алгоритму:
- участок включает в себя ЛЕВУЮ границу участка разбега при взлёте
- участок отступает ВЛЕВО от ЛЕВОЙ границы участка разбега при взлёте не более, чем на величину значения `relative_range_width[0]`*`duration[-1]` соотвествующего диапазона
- участок отступает ВПРАВО от ЛЕВОЙ границы участка разбега при взлёте не более, чем на величину значения `relative_range_width[-1]`*`duration[-1]` соотвествующего диапазона
- горизонтальная скорость (`horizontal_speed`) непрерывно находится в диапазоне от `hspeed[0]` до hspeed[-1] соотвествующего диапазона
- длительность участка находится в диапазоне от `duration[0]` до `duration[-1]` соотвествующего диапазона

### 11. Выделение участков пересечения потенциальных участков пробега после посадки с потенциальными участками рулежки после посадки (lrlt) по следующему алгоритму:
- участок включает в себя ПРАВУЮ границу участка пробега после посадки
- участок отступает ВЛЕВО от ПРАВОЙ границы участка пробега после посадки не более, чем на величину значения `relative_range_width[0]`*`duration[-1]` соотвествующего диапазона
- участок отступает ВПРАВО от ПРАВОЙ границы участка пробега после посадки не более, чем на величину значения `relative_range_width[-1]`*`duration[-1]` соотвествующего диапазона
- горизонтальная скорость (`horizontal_speed`) непрерывно находится в диапазоне от `hspeed[0]` до hspeed[-1] соотвествующего диапазона
- длительность участка находится в диапазоне от `duration[0]` до `duration[-1]` соотвествующего диапазона

</blockquote></details>


</blockquote></details>







